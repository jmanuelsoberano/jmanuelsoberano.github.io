---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const sortedProjects = projects.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);
---

<BaseLayout 
  title="Proyectos" 
  description="Case studies y proyectos de desarrollo de software."
>
  <div class="page-container">
    <header class="page-header">
      <h1>Proyectos</h1>
      <p class="page-description">
        Una selección de proyectos y case studies de mi trabajo como desarrollador.
      </p>
    </header>

    <div class="projects-list">
      {sortedProjects.length > 0 ? (
        sortedProjects.map(project => (
          <article class="project-item">
            <div class="project-meta">
              <time datetime={project.data.date.toISOString()}>
                {project.data.date.toLocaleDateString('es-ES', { 
                  year: 'numeric', 
                  month: 'short'
                })}
              </time>
              {project.data.client && (
                <span class="client">{project.data.client}</span>
              )}
            </div>
            <div class="project-content">
              <h2>
                <a href={`/proyectos/${project.slug}`}>{project.data.title}</a>
              </h2>
              <p>{project.data.description}</p>
              <div class="project-stack">
                {project.data.stack.map(tech => (
                  <span class="tag">{tech}</span>
                ))}
              </div>
            </div>
          </article>
        ))
      ) : (
        <p class="empty-state">No hay proyectos publicados aún. ¡Pronto habrá contenido!</p>
      )}
    </div>
  </div>
</BaseLayout>

<style>
  .page-container {
    max-width: var(--content-wide);
    margin: 0 auto;
    padding: var(--space-8) var(--space-6);
  }
  
  .page-header {
    margin-bottom: var(--space-8);
  }
  
  .page-header h1 {
    margin-bottom: var(--space-4);
  }
  
  .page-description {
    font-size: var(--text-lg);
    color: var(--text-secondary);
    max-width: 50ch;
  }
  
  .projects-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
  }
  
  .project-item {
    display: grid;
    gap: var(--space-4);
    padding-bottom: var(--space-8);
    border-bottom: 1px solid var(--border);
  }
  
  @media (min-width: 768px) {
    .project-item {
      grid-template-columns: 120px 1fr;
      gap: var(--space-8);
    }
  }
  
  .project-meta {
    font-size: var(--text-sm);
    color: var(--text-muted);
  }
  
  .project-meta .client {
    display: block;
    margin-top: var(--space-1);
    font-weight: 500;
    color: var(--text-secondary);
  }
  
  .project-content h2 {
    font-size: var(--text-2xl);
    margin-bottom: var(--space-3);
  }
  
  .project-content h2 a {
    color: var(--text-primary);
    text-decoration: none;
  }
  
  .project-content h2 a:hover {
    color: var(--accent);
  }
  
  .project-content p {
    font-size: var(--text-base);
    margin-bottom: var(--space-4);
  }
  
  .project-stack {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }
  
  .empty-state {
    color: var(--text-muted);
    font-style: italic;
    text-align: center;
    padding: var(--space-12);
  }
</style>
